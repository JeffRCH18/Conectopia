{% extends 'applicationBase.html' %}

{% block content %}
{% load static %}

<style>
    .btn-outline-app {
        color: rgb(177, 156, 217);
        /* Text color */
        background-color: transparent;
        /* Transparent background */
        border: 2px solid rgb(177, 156, 217);
        /* Border color */
    }

    /* Hover effect */
    .btn-outline-app:hover {
        background-color: rgba(177, 156, 217, 0.514);
        /* Background color on hover */
        color: #fff;
        /* Text color on hover */
    }
</style>

<!-- New Post -->
<div class="row">
    <div class="card" style="background-color: rgba(177, 156, 217, 0.062); border: none;">
        <div class="card-body">
            <form action="/createPost/" method="POST" enctype="multipart/form-data">
                {% csrf_token %}
                <div class="row justify-content-center">
                    <div class="col-md-2">
                        <img src="{% static user.imagen %}" alt="profilepic" class="rounded-circle img-fluid bg-white"
                            style="object-fit: cover; width: 80%; height: 75px">
                    </div>
                    <div class="col-md-10">
                        <input type="text" name="txtPost" id="txtPost" class="form-control"
                            placeholder="Share your thoughts" style="width: 100%; height: 100px;" required>
                        <div class="row" style="margin-top: 10px;">
                            <div class="col-md-6">
                                <input type="file" name="txtPostImage" id="txtPostImage" class="form-control"
                                    accept="image/*">
                            </div>
                            <div class="col-md-6">
                                <select id="txtPreference" name="txtPreference" class="form-control" required>
                                    {% for posiblePreference in preferencePost%}
                                    <option value="{{posiblePreference.pk}}">{{posiblePreference.gusto}}</option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>

                        <div class="row" style="margin-top: 10px;">
                            <div class="col-12">
                                <img src="" alt="" style="width: 100%;" id="postImage" name="postImage">
                            </div>
                        </div>

                    </div>
                </div>

                <div class="row justify-content-center" style="margin-top: 25px;">
                    <button class="btn btn-outline-app">Post</button>
                </div>
            </form>
        </div>
    </div>

</div>

<!-- Post List -->
<div class="row justify-content-center" style="margin-top: 25px;">
    <h4 class="text-muted text-center">What's new today</h4>
    {% for post in postList %}
    <div class="row" style="margin-top: 10px;">
        <div class="card" style="background-color: rgba(177, 156, 217, 0.062); border: none">
            <div class="card-body">
                <div class="row">
                    <div class="col-md-2">
                        <img src="{% static post.usuario.imagen %}" alt="profilepic"
                            class="rounded-circle img-fluid bg-white"
                            style="object-fit: cover; width: 80%; height: 75px">
                    </div>
                    <div class="col-md-10">
                        <p class="text-muted">{{post.usuario.nombre}}</p>
                        <p>{{post.contenido}} - <span class="badge badge-pill badge-info"
                                style="background-color:  rgb(177, 156, 217) !important;">{{post.preferencia.gusto}}</span>
                        </p>
                        <img src="{% static post.imagen %}" alt="" style="width: 100%;" id="postImage" name="postImage">
                    </div>
                </div>
                <div class="row" style="margin-top: 15px">
                    <div class="col-12">
                        <button class="btn btn-outline-app">
                            <i class="fa-regular fa-heart" style="margin-right: 7px;"></i>Like
                        </button>
                        <button class="btn btn-outline-app">
                            <i class="fa-regular fa-comment" style="margin-right: 7px;"></i>Comments
                        </button>

                        {% if post.usuario.pk == user.pk %}
                            <button class="btn btn-outline-app">
                                <i class="fa-regular fa-pen-to-square" style="margin-right: 7px;"></i>Edit
                            </button>
                        
                            <button class="btn btn-outline-app">
                                <i class="fa-regular fa-trash-can" style="margin-right: 7px;"></i>Delete
                            </button>
                        {% endif %}

                    </div>

                </div>
            </div>
        </div>
    </div>
    {% endfor %}
</div>


<script>
    const fileEl = document.getElementById('txtPostImage');

    fileEl.addEventListener('change', () => {

        const fr = new FileReader();
        fr.readAsDataURL(fileEl.files[0]);

        fr.addEventListener('load', () => {
            const url = fr.result;
            document.getElementById('postImage').src = url;
        })
    })

</script>

{% endblock %}